/*

  jsOAuth version 1.3.1
  Copyright (c) 2010, 2011 Rob Griffiths (http://bytespider.eu)
  jsOAuth is freely distributable under the terms of an MIT-style license.
*/
var exports=exports||this;
exports.OAuth=function(q){function s(a){var b=arguments.callee,c;if(!(this instanceof b))return new b(a);for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);return this}function g(){}function A(a){var b=arguments.callee,c,d,e,f,r;d=/^([^:\/?#]+?:\/\/)*([^\/:?#]*)?(:[^\/?#]*)*([^?#]*)(\?[^#]*)?(#(.*))*/;if(!(this instanceof b))return new b(a);this.path=this.port=this.host=this.scheme="";this.query=new l;this.anchor="";if(null!==a){c=a.match(d);b=c[1];d=c[2];e=c[3];f=c[4];r=c[5];c=c[6];b=void 0!==b?b.replace("://",
"").toLowerCase():"http";e=e?e.replace(":",""):"https"===b?"443":"80";b="http"==b&&"443"===e?"https":b;r=r?r.replace("?",""):"";c=c?c.replace("#",""):"";if("https"===b&&"443"!==e||"http"===b&&"80"!==e)d=d+":"+e;this.scheme=b;this.host=d;this.port=e;this.path=f||"/";this.query.setQueryParams(r);this.anchor=c||""}}function l(a){var b=arguments.callee,c;if(!(this instanceof b))return new b(a);if(void 0!=a)for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);return this}function k(a){return this instanceof
k?this.init(a):new k(a)}function w(a){var b=[],c,d;for(c in a)a[c]&&void 0!==a[c]&&""!==a[c]&&("realm"===c?d=c+'="'+a[c]+'"':b.push(c+'="'+k.urlEncode(a[c]+"")+'"'));b.sort();d&&b.unshift(d);return b.join(", ")}function C(a,b,c,d){var e=[],f,r=k.urlEncode;for(f in c)void 0!==c[f]&&""!==c[f]&&e.push(k.urlEncode(f)+"="+k.urlEncode(c[f]+""));for(f in d)void 0!==d[f]&&""!==d[f]&&(c[f]||e.push(r(f)+"="+r(d[f]+"")));return[a,r(b),r(e.sort().join("&"))].join("&")}function D(a){function b(){return Math.floor(Math.random()*
f.length)}var c=(a||64)/8;a="";var d=c/4,c=c%4,e,f="20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 33 34 35 36 37 38 39 3A 3B 3C 3D 3E 3F 40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F 60 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 7B 7C 7D 7E".split(" ");for(e=0;e<d;e++)a+=f[b()]+f[b()]+f[b()]+f[b()];for(e=0;e<c;e++)a+=f[b()];return a}function E(a){return Array(++a).join(0).split("")}function v(a){var b=
[],c,d;for(d=0;d<a.length;d++)c=a.charCodeAt(d),128>c?b.push(c):2048>c?b.push(192+(c>>6),128+(c&63)):65536>c?b.push(224+(c>>12),128+(c>>6&63),128+(c&63)):2097152>c&&b.push(240+(c>>18),128+(c>>12&63),128+(c>>6&63),128+(c&63));return b}function h(a){if(void 0!==a){var b=a;b.constructor===String&&(b=v(b));a=(this instanceof h?this:new h(a)).hash(b);var b=[],c=a.length,d;for(d=0;d<c;d++)b.push((a[d]>>>4).toString(16)),b.push((a[d]&15).toString(16));return b.join("")}return this instanceof h?this:new h}
g.prototype={join:function(a){a=a||"";return this.values().join(a)},keys:function(){var a,b=[];for(a in this)this.hasOwnProperty(a)&&b.push(a);return b},values:function(){var a,b=[];for(a in this)this.hasOwnProperty(a)&&b.push(this[a]);return b},shift:function(){throw"not implimented";},unshift:function(){throw"not implimented";},push:function(){throw"not implimented";},pop:function(){throw"not implimented";},sort:function(){throw"not implimented";},ksort:function(a){var b=this.keys(),c,d;void 0==
a?b.sort():b.sort(a);for(a=0;a<b.length;a++)d=b[a],c=this[d],delete this[d],this[d]=c;return this},toObject:function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a}};s.prototype=new g;A.prototype={scheme:"",host:"",port:"",path:"",query:"",anchor:"",toString:function(){var a=this.query+"";return this.scheme+"://"+this.host+this.path+(""!=a?"?"+a:"")+(""!==this.anchor?"#"+this.anchor:"")}};l.prototype=new s;l.prototype.toString=function(){var a,b=[],c="",d="",e=k.urlEncode;
this.ksort();for(a in this)this.hasOwnProperty(a)&&void 0!=a&&void 0!=this[a]&&(d=e(a)+"="+e(this[a]),b.push(d));0<b.length&&(c=b.join("&"));return c};l.prototype.setQueryParams=function(a){var b=arguments,c,d,e;if(1==b.length)if("object"===typeof a)for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);else{if("string"===typeof a)for(b=a.split("&"),c=0,d=b.length;c<d;c++)e=b[c].split("="),this[e[0]]=e[1]}else for(c=0;c<arg_length;c+=2)this[b[c]]=b[c+1]};k.prototype={realm:"",requestTokenUrl:"",authorizationUrl:"",
accessTokenUrl:"",init:function(a){var b=a.enablePrivilege||!1,c=a.callbackUrl||"oob",d=a.consumerKey,e=a.consumerSecret,f=a.accessTokenKey||"",r=a.accessTokenSecret||"",B="",x=a.signatureMethod||"HMAC-SHA1";this.realm=a.realm||"";this.requestTokenUrl=a.requestTokenUrl||"";this.authorizationUrl=a.authorizationUrl||"";this.accessTokenUrl=a.accessTokenUrl||"";this.getAccessToken=function(){return[f,r]};this.getAccessTokenKey=function(){return f};this.getAccessTokenSecret=function(){return r};this.setAccessToken=
function(a,b){b&&(a=[a,b]);f=a[0];r=a[1]};this.getVerifier=function(){return B};this.setVerifier=function(a){B=a};this.setCallbackUrl=function(a){c=a};this.request=function(a){var y,n,m,u,F,l,p,t,g,h=[],s;g={};var v,z;y=a.method||"GET";n=A(a.url);m=a.data||{};u=a.headers||{};F=a.success||function(){};l=a.failure||function(){};z=function(){var a=!1,b;for(b in m)"undefined"!=typeof m[b].fileName&&(a=!0);return a}();s=a.appendQueryString?a.appendQueryString:!1;b&&netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
p="undefined"!==typeof q.Titanium&&"undefined"!=typeof q.Titanium.Network.createHTTPClient?q.Titanium.Network.createHTTPClient():"undefined"!==typeof require?(new require("xhr")).XMLHttpRequest():new q.XMLHttpRequest;p.onreadystatechange=function(){if(4===p.readyState){var a=/^(.*?):\s*(.*?)\r?$/mg,b={},c="",d;if(p.getAllResponseHeaders)for(c=p.getAllResponseHeaders();d=a.exec(c);)b[d[1]]=d[2];else if(p.getResponseHeaders)for(c=p.getResponseHeaders(),a=0,d=c.length;a<d;++a)b[c[a][0]]=c[a][1];b={text:p.responseText,
requestHeaders:u,responseHeaders:b};200<=p.status&&226>=p.status||304==p.status||0===p.status?F(b):400<=p.status&&0!==p.status&&l(b)}};a={oauth_callback:c,oauth_consumer_key:d,oauth_token:f,oauth_signature_method:x,oauth_timestamp:parseInt(+new Date/1E3,10),oauth_nonce:D(),oauth_verifier:B,oauth_version:"1.0"};if(!("Content-Type"in u&&"application/x-www-form-urlencoded"!=u["Content-Type"]||z)){v=n.query.toObject();for(t in v)g[t]=v[t];for(t in m)g[t]=m[t]}urlString=n.scheme+"://"+n.host+n.path;g=
C(y,urlString,a,g);g=k.signatureMethod[x](e,r,g);a.oauth_signature=g;this.realm&&(a.realm=this.realm);if(s||"GET"==y)n.query.setQueryParams(m),h=null;else if(!z)if("string"==typeof m)h=m,"Content-Type"in u||(u["Content-Type"]="text/plain");else{for(t in m)h.push(k.urlEncode(t)+"="+k.urlEncode(m[t]+""));h=h.sort().join("&");"Content-Type"in u||(u["Content-Type"]="application/x-www-form-urlencoded")}else if(z)for(t in h=new FormData,m)h.append(t,m[t]);p.open(y,n+"",!0);p.setRequestHeader("Authorization",
"OAuth "+w(a));p.setRequestHeader("X-Requested-With","XMLHttpRequest");for(t in u)p.setRequestHeader(t,u[t]);p.send(h)};this.postPG=function(a,b,c,m){var g={oauth_consumer_key:d,oauth_token:f,oauth_signature_method:x,oauth_timestamp:parseInt(+new Date/1E3,10),oauth_nonce:D(),oauth_version:"1.0"},h=A(a),h=C("POST",h.scheme+"://"+h.host+h.path,g,b.params),h=k.signatureMethod[x](e,r,h);g.oauth_signature=h;(new FileTransfer).upload(b.uri,a+"",c,m,new FileUploadOptions(b.key,b.name,b.type,b.params,{Authorization:"OAuth "+
w(g)}))};return this},get:function(a,b,c){this.request({url:a,success:b,failure:c})},post:function(a,b,c,d){this.request({method:"POST",url:a,data:b,success:c,failure:d})},getJSON:function(a,b,c){this.get(a,function(a){b(JSON.parse(a.text))},c)},postJSON:function(a,b,c,d){this.post(a,JSON.stringify(b),function(a){c(JSON.parse(a.text))},d)},parseTokenRequest:function(a){var b=0;a=a.split("&");for(var c=a.length,d={};b<c;++b){var e=a[b].split("=");d[k.urlDecode(e[0])]=k.urlDecode(e[1])}return d},fetchRequestToken:function(a,
b){var c=this;c.setAccessToken("","");var d=c.authorizationUrl;this.get(this.requestTokenUrl,function(b){var f=c.parseTokenRequest(b.text);c.setAccessToken([f.oauth_token,f.oauth_token_secret]);a(d+"?"+b.text)},b)},fetchAccessToken:function(a,b){var c=this;this.get(this.accessTokenUrl,function(b){var e=c.parseTokenRequest(b.text);c.setAccessToken([e.oauth_token,e.oauth_token_secret]);c.setVerifier("");a(b)},b)}};k.signatureMethod={"HMAC-SHA1":function(a,b,c){var d=k.urlEncode;a=d(a);b=d(b||"");d=
h.prototype;a=v(a+"&"+b);c=v(c);b=a.length;var e;b>d.blocksize&&(a=d.hash(a),b=a.length);a=a.concat(E(d.blocksize-b));b=a.slice(0);a=a.slice(0);for(e=0;e<d.blocksize;e++)b[e]^=92,a[e]^=54;d=d.hash(b.concat(d.hash(a.concat(c))));c="";a=d.length;for(b=0;b<a;b++)c+=String.fromCharCode(d[b]);return q.btoa(c)}};k.urlEncode=function(a){function b(a){a=a.toString(16).toUpperCase();2>a.length&&(a=0+a);return"%"+a}if(!a)return"";a+="";var c=/[ \r\n!*"'();:@&=+$,\/?%#\[\]<>{}|`^\\\u0080-\uffff]/,d=a.length,
e=a.split(""),f;for(a=0;a<d;a++)if(f=e[a].match(c))f=f[0].charCodeAt(0),128>f?e[a]=b(f):2048>f?e[a]=b(192+(f>>6))+b(128+(f&63)):65536>f?e[a]=b(224+(f>>12))+b(128+(f>>6&63))+b(128+(f&63)):2097152>f&&(e[a]=b(240+(f>>18))+b(128+(f>>12&63))+b(128+(f>>6&63))+b(128+(f&63)));return e.join("")};k.urlDecode=function(a){return a?a.replace(/%[a-fA-F0-9]{2}/ig,function(a){return String.fromCharCode(parseInt(a.replace("%",""),16))}):""};h.prototype=new h;h.prototype.blocksize=64;h.prototype.hash=function(a){var b=
[1732584193,4023233417,2562383102,271733878,3285377520],c=[1518500249,1859775393,2400959708,3395469782],d,e,f,k,h,g,l,s,n,m;a.constructor===String&&(a=v(a.encodeUTF8()));d=a.length;f=Math.ceil((d+9)/this.blocksize)*this.blocksize-(d+9);e=Math.floor(d/4294967296);d=Math.floor(d%4294967296);e=[8*e>>24&255,8*e>>16&255,8*e>>8&255,8*e&255,8*d>>24&255,8*d>>16&255,8*d>>8&255,8*d&255];a=a.concat([128],E(f),e);f=Math.ceil(a.length/this.blocksize);for(e=0;e<f;e++){k=a.slice(e*this.blocksize,(e+1)*this.blocksize);
h=k.length;d=[];for(g=0;g<h;g++)d[g>>>2]|=k[g]<<24-8*(g-4*(g>>2));k=b[0];h=b[1];g=b[2];l=b[3];s=b[4];for(n=0;80>n;n++){16<=n&&(m=d[n-3]^d[n-8]^d[n-14]^d[n-16],d[n]=m<<1|m>>>31);m=Math.floor(n/20);var u=k<<5|k>>>27,q;a:{switch(m){case 0:q=h&g|~h&l;break a;case 1:case 3:q=h^g^l;break a;case 2:q=h&g|h&l|g&l;break a}q=-1}m=u+q+s+c[m]+d[n];s=l;l=g;g=h<<30|h>>>2;h=k;k=m}b[0]+=k;b[1]+=h;b[2]+=g;b[3]+=l;b[4]+=s}a=[];for(c=0;c<32*b.length;c+=8)a.push(b[c>>>5]>>>24-c%32&255);return a};return k}(this);
(function(q){q.btoa=q.btoa||function(s){for(var g=0,q=s.length,l,k,w="";g<q;g+=3)l=[s.charCodeAt(g),s.charCodeAt(g+1),s.charCodeAt(g+2)],k=[l[0]>>2,(l[0]&3)<<4|l[1]>>4,(l[1]&15)<<2|l[2]>>6,l[2]&63],isNaN(l[1])&&(k[2]=64),isNaN(l[2])&&(k[3]=64),w+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k[0])+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k[1])+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k[2])+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k[3]);
return w}})(this);
